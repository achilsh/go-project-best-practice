* 如何发布云端服务？目标：发布时要尽量减少对线上业务影响；发布前有充分的验证，发布步骤有条理，结果要正确； 出现问题也能快速回滚。
* 发布的策略分类：
* 1） 停机停服发布。该策略发布前的准备有：新服务验证充分；发布前需要发通告。适用场景：对系统可用性要求不高的系统，在业务低峰期进行版本升级。
  
* 2） 蓝绿发布。需要部署一套新绿环境，然后在新环境上验证待发布功能，验证无误后再通过流量调度，逐步将线上流量从蓝环境切换到绿环境。在整个切换过程中，用户几乎察觉不到任何服务中断，有力保障了业务的连续性。而且如果新版本上线后出现问题，我们能够立刻将流量重新切回蓝环境，快速恢复到旧版本，最大限度降低对业务的影响。它需要同时维护两套完整的运行环境，这就导致它的资源成本相对较高。所以，它更适合于那些对系统可用性有着超高要求，且一旦出现问题必须立即快速回滚的极为严苛的应用场景。
* 3）滚动发布。滚动部署是一种按比例分批将新版本部署到各个服务器上的策略。首先将部分服务流量切为0，然后再在没有流量的机器上部署新服务，等部署新的服务后再把流量打开，进行观察。此类操作持续分批进行。相较于蓝绿部署，滚动部署具有独特优势，它无需额外搭建环境资源，直接在原有的服务器集群上进行更新，资源利用效率高。
* 4） 灰度发布。将新版本代码部署到一小部分特定的服务器，通过观察他们的使用情况来判断新版本是否存在问题。一旦确认这些服务器上新版本运行无误，我们就可以通过其它方式逐步扩大新版本的部署范围，直到最终全面替换旧版本，实现新版本的平稳上线。和滚动部署相比，灰度部署的优势在于能够先把新版本部署到某些特定的灰度机器上，并且会提前为这些灰度机器配置单独的监控。通过这种方式，我们更加容易发现新版本可能潜藏的问题，进而有效降低发布风险。
* 5）灰度+滚动发布。首先将新版本部署到灰度机器上，对它们的运行情况进行一段时间的观察，确认没有问题之后，再按照一定的比例，采用滚动部署的方式对其他机器进行更新，最终实现全量发布。


#
上面灰度策略是将对服务和机器维度上的。实际还可对业务维度进行灰度，比如：

* 基于用户 ID 的灰度方案。这种方案通过将用户 ID 进行分组，使得一部分用户能够体验新功能逻辑，而另一部分用户则继续使用旧功能逻辑.
* 基于用户角色的灰度方案。比如，我们可以先让 VIP、SVIP 用户优先体验新版本，对这些用户的使用情况进行监控，根据反馈和使用情况，及时或优化新功能，确保上线之后的新版本能较好地满足核心用户的需求。
* 基于地理位置的灰度。这种方案将用户按照地理位置进行分组，先在某个城市或地区灰度新功能，根据监控结果和业务需求，逐步扩大灰度地区的范围，直到全面上线新功能。
* 基于用户行为的灰度。这种方案根据用户在系统中的行为特征来进行灰度划分。
* 基于设备类型的灰度。这种方案按设备类型对用户进行分组灰度测试。比如先在安卓设备上推出新版本，观察不同安卓设备的兼容性和性能表现，因为安卓设备种类繁多，不同的硬件和系统版本可能对软件的运行有不同影响；或者先在桌面端推出，再逐步推广到移动端，根据不同设备类型的特点和用户群体，有针对性地开展灰度测试。
* .....